auth_tests  | Waiting for PostgreSQL (db:5432) to be accessible...
auth_tests  | PostgreSQL est accessible. Démarrage de l'application...
auth_tests  | INFO  [alembic.runtime.migration] Context impl PostgresqlImpl.
auth_tests  | INFO  [alembic.runtime.migration] Will assume transactional DDL.
auth_tests  | Configuration chargée. DB URL: postgresql+asyncpg://postgres:***@db:5432/auth_db
auth_tests  | ============================= test session starts ==============================
auth_tests  | platform linux -- Python 3.12.12, pytest-9.0.2, pluggy-1.6.0
auth_tests  | rootdir: /app
auth_tests  | configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
auth_tests  | plugins: asyncio-1.3.0, anyio-4.12.0
auth_tests  | asyncio: mode=Mode.AUTO, debug=False, asyncio_default_fixture_loop_scope=function, asyncio_default_test_loop_scope=function
auth_tests  | collected 3 items
auth_tests  | 
auth_tests  | tests/test_auth.py .FF                                                   [100%]
auth_tests  | 
auth_tests  | =================================== FAILURES ===================================
auth_tests  | ______________________________ test_register_user ______________________________
auth_tests  | 
auth_tests  | async_client = <httpx.AsyncClient object at 0x7e6c5c2fc110>
auth_tests  | 
auth_tests  |     async def test_register_user(async_client: AsyncClient):
auth_tests  |         payload = {
auth_tests  |             "email": "test@example.com",
auth_tests  |             "password": "password123"
auth_tests  |         }
auth_tests  | >       response = await async_client.post("/auth/register", json=payload)
auth_tests  |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
auth_tests  | 
auth_tests  | tests/test_auth.py:17: 
auth_tests  | _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
auth_tests  | .venv/lib/python3.12/site-packages/httpx/_client.py:1859: in post
auth_tests  |     return await self.request(
auth_tests  | .venv/lib/python3.12/site-packages/httpx/_client.py:1540: in request
auth_tests  |     return await self.send(request, auth=auth, follow_redirects=follow_redirects)
auth_tests  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
auth_tests  | .venv/lib/python3.12/site-packages/httpx/_client.py:1629: in send
auth_tests  |     response = await self._send_handling_auth(
auth_tests  | .venv/lib/python3.12/site-packages/httpx/_client.py:1657: in _send_handling_auth
auth_tests  |     response = await self._send_handling_redirects(
auth_tests  | .venv/lib/python3.12/site-packages/httpx/_client.py:1694: in _send_handling_redirects
auth_tests  |     response = await self._send_single_request(request)
auth_tests  |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
auth_tests  | .venv/lib/python3.12/site-packages/httpx/_client.py:1730: in _send_single_request
auth_tests  |     response = await transport.handle_async_request(request)
auth_tests  |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
auth_tests  | .venv/lib/python3.12/site-packages/httpx/_transports/asgi.py:170: in handle_async_request
auth_tests  |     await self.app(scope, receive, send)
auth_tests  | .venv/lib/python3.12/site-packages/fastapi/applications.py:1139: in __call__
auth_tests  |     await super().__call__(scope, receive, send)
auth_tests  | .venv/lib/python3.12/site-packages/starlette/applications.py:107: in __call__
auth_tests  |     await self.middleware_stack(scope, receive, send)
auth_tests  | .venv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__
auth_tests  |     raise exc
auth_tests  | .venv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__
auth_tests  |     await self.app(scope, receive, _send)
auth_tests  | .venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__
auth_tests  |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
auth_tests  | .venv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
auth_tests  |     raise exc
auth_tests  | .venv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app
auth_tests  |     await app(scope, receive, sender)
auth_tests  | .venv/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
auth_tests  |     await self.app(scope, receive, send)
auth_tests  | .venv/lib/python3.12/site-packages/starlette/routing.py:716: in __call__
auth_tests  |     await self.middleware_stack(scope, receive, send)
auth_tests  | .venv/lib/python3.12/site-packages/starlette/routing.py:736: in app
auth_tests  |     await route.handle(scope, receive, send)
auth_tests  | .venv/lib/python3.12/site-packages/starlette/routing.py:290: in handle
auth_tests  |     await self.app(scope, receive, send)
auth_tests  | .venv/lib/python3.12/site-packages/fastapi/routing.py:120: in app
auth_tests  |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
auth_tests  | .venv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
auth_tests  |     raise exc
auth_tests  | .venv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app
auth_tests  |     await app(scope, receive, sender)
auth_tests  | .venv/lib/python3.12/site-packages/fastapi/routing.py:106: in app
auth_tests  |     response = await f(request)
auth_tests  |                ^^^^^^^^^^^^^^^^
auth_tests  | .venv/lib/python3.12/site-packages/fastapi/routing.py:430: in app
auth_tests  |     raw_response = await run_endpoint_function(
auth_tests  | .venv/lib/python3.12/site-packages/fastapi/routing.py:316: in run_endpoint_function
auth_tests  |     return await dependant.call(**values)
auth_tests  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
auth_tests  | src/modules/auth/auth_router.py:38: in register
auth_tests  |     return await auth_service.register_new_user(user_in)
auth_tests  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
auth_tests  | src/modules/auth/auth_app.py:28: in register_new_user
auth_tests  |     hashed_password = get_password_hash(user_in.password)
auth_tests  |                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
auth_tests  | src/modules/auth/auth_metier.py:15: in get_password_hash
auth_tests  |     return pwd_context.hash(password)
auth_tests  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^
auth_tests  | .venv/lib/python3.12/site-packages/passlib/context.py:2258: in hash
auth_tests  |     return record.hash(secret, **kwds)
auth_tests  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
auth_tests  | .venv/lib/python3.12/site-packages/passlib/utils/handlers.py:779: in hash
auth_tests  |     self.checksum = self._calc_checksum(secret)
auth_tests  |                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^
auth_tests  | .venv/lib/python3.12/site-packages/passlib/handlers/bcrypt.py:591: in _calc_checksum
auth_tests  |     self._stub_requires_backend()
auth_tests  | .venv/lib/python3.12/site-packages/passlib/utils/handlers.py:2254: in _stub_requires_backend
auth_tests  |     cls.set_backend()
auth_tests  | .venv/lib/python3.12/site-packages/passlib/utils/handlers.py:2156: in set_backend
auth_tests  |     return owner.set_backend(name, dryrun=dryrun)
auth_tests  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
auth_tests  | .venv/lib/python3.12/site-packages/passlib/utils/handlers.py:2163: in set_backend
auth_tests  |     return cls.set_backend(name, dryrun=dryrun)
auth_tests  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
auth_tests  | .venv/lib/python3.12/site-packages/passlib/utils/handlers.py:2188: in set_backend
auth_tests  |     cls._set_backend(name, dryrun)
auth_tests  | .venv/lib/python3.12/site-packages/passlib/utils/handlers.py:2311: in _set_backend
auth_tests  |     super(SubclassBackendMixin, cls)._set_backend(name, dryrun)
auth_tests  | .venv/lib/python3.12/site-packages/passlib/utils/handlers.py:2224: in _set_backend
auth_tests  |     ok = loader(**kwds)
auth_tests  |          ^^^^^^^^^^^^^^
auth_tests  | .venv/lib/python3.12/site-packages/passlib/handlers/bcrypt.py:626: in _load_backend_mixin
auth_tests  |     return mixin_cls._finalize_backend_mixin(name, dryrun)
auth_tests  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
auth_tests  | .venv/lib/python3.12/site-packages/passlib/handlers/bcrypt.py:421: in _finalize_backend_mixin
auth_tests  |     if detect_wrap_bug(IDENT_2A):
auth_tests  |        ^^^^^^^^^^^^^^^^^^^^^^^^^
auth_tests  | .venv/lib/python3.12/site-packages/passlib/handlers/bcrypt.py:380: in detect_wrap_bug
auth_tests  |     if verify(secret, bug_hash):
auth_tests  |        ^^^^^^^^^^^^^^^^^^^^^^^^
auth_tests  | .venv/lib/python3.12/site-packages/passlib/utils/handlers.py:792: in verify
auth_tests  |     return consteq(self._calc_checksum(secret), chk)
auth_tests  |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^
auth_tests  | _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
auth_tests  | 
auth_tests  | self = <passlib.handlers.bcrypt._BcryptBackend object at 0x7e6c5c33dc70>
auth_tests  | secret = b'01234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345...7890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234'
auth_tests  | 
auth_tests  |     def _calc_checksum(self, secret):
auth_tests  |         # bcrypt behavior:
auth_tests  |         #   secret must be bytes
auth_tests  |         #   config must be ascii bytes
auth_tests  |         #   returns ascii bytes
auth_tests  |         secret, ident = self._prepare_digest_args(secret)
auth_tests  |         config = self._get_config(ident)
auth_tests  |         if isinstance(config, unicode):
auth_tests  |             config = config.encode("ascii")
auth_tests  | >       hash = _bcrypt.hashpw(secret, config)
auth_tests  |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
auth_tests  | E       ValueError: password cannot be longer than 72 bytes, truncate manually if necessary (e.g. my_password[:72])
auth_tests  | 
auth_tests  | .venv/lib/python3.12/site-packages/passlib/handlers/bcrypt.py:655: ValueError
auth_tests  | ------------------------------ Captured log call -------------------------------
auth_tests  | WARNING  passlib.handlers.bcrypt:bcrypt.py:622 (trapped) error reading bcrypt version
auth_tests  | Traceback (most recent call last):
auth_tests  |   File "/app/.venv/lib/python3.12/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
auth_tests  |     version = _bcrypt.__about__.__version__
auth_tests  |               ^^^^^^^^^^^^^^^^^
auth_tests  | AttributeError: module 'bcrypt' has no attribute '__about__'
auth_tests  | _______________________________ test_login_user ________________________________
auth_tests  | 
auth_tests             | async_client = <httpx.AsyncClient object at 0x7e6c5c33fda0>
auth_tests             | 
auth_tests             |     async def test_login_user(async_client: AsyncClient):
auth_tests             |         # D'abord on enregistre (au cas où l'ordre des tests n'est pas garanti ou DB vide)
auth_tests             |         # Idéalement on utiliserait une fixture pour créer un user
auth_tests             |         payload = {
auth_tests             |             "email": "login_test@example.com",
auth_tests             |             "password": "password123"
auth_tests             |         }
6471b28a76b7_auth_api  | Waiting for PostgreSQL (db:5432) to be accessible...
6471b28a76b7_auth_api  | PostgreSQL est accessible. Démarrage de l'application...
6471b28a76b7_auth_api  | INFO:     Started server process [1]
6471b28a76b7_auth_api  | INFO:     Waiting for application startup.
6471b28a76b7_auth_api  | INFO:     Application startup complete.
6471b28a76b7_auth_api  | INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
auth_tests             | >       await async_client.post("/auth/register", json=payload)
auth_tests             | 
auth_tests             | tests/test_auth.py:31: 
auth_tests             | _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
auth_tests             | .venv/lib/python3.12/site-packages/httpx/_client.py:1859: in post
auth_tests             |     return await self.request(
auth_tests             | .venv/lib/python3.12/site-packages/httpx/_client.py:1540: in request
auth_tests             |     return await self.send(request, auth=auth, follow_redirects=follow_redirects)
auth_tests             |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
auth_tests             | .venv/lib/python3.12/site-packages/httpx/_client.py:1629: in send
auth_tests             |     response = await self._send_handling_auth(
auth_tests             | .venv/lib/python3.12/site-packages/httpx/_client.py:1657: in _send_handling_auth
auth_tests             |     response = await self._send_handling_redirects(
auth_tests             | .venv/lib/python3.12/site-packages/httpx/_client.py:1694: in _send_handling_redirects
auth_tests             |     response = await self._send_single_request(request)
auth_tests             |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
auth_tests             | .venv/lib/python3.12/site-packages/httpx/_client.py:1730: in _send_single_request
auth_tests             |     response = await transport.handle_async_request(request)
auth_tests             |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
auth_tests             | .venv/lib/python3.12/site-packages/httpx/_transports/asgi.py:170: in handle_async_request
auth_tests             |     await self.app(scope, receive, send)
auth_tests             | .venv/lib/python3.12/site-packages/fastapi/applications.py:1139: in __call__
auth_tests             |     await super().__call__(scope, receive, send)
auth_tests             | .venv/lib/python3.12/site-packages/starlette/applications.py:107: in __call__
auth_tests             |     await self.middleware_stack(scope, receive, send)
auth_tests             | .venv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__
auth_tests             |     raise exc
auth_tests             | .venv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__
auth_tests             |     await self.app(scope, receive, _send)
auth_tests             | .venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__
auth_tests             |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
auth_tests             | .venv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
auth_tests             |     raise exc
auth_tests             | .venv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app
auth_tests             |     await app(scope, receive, sender)
auth_tests             | .venv/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
auth_tests             |     await self.app(scope, receive, send)
auth_tests             | .venv/lib/python3.12/site-packages/starlette/routing.py:716: in __call__
auth_tests             |     await self.middleware_stack(scope, receive, send)
auth_tests             | .venv/lib/python3.12/site-packages/starlette/routing.py:736: in app
auth_tests             |     await route.handle(scope, receive, send)
auth_tests             | .venv/lib/python3.12/site-packages/starlette/routing.py:290: in handle
auth_tests             |     await self.app(scope, receive, send)
auth_tests             | .venv/lib/python3.12/site-packages/fastapi/routing.py:120: in app
auth_tests             |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
auth_tests             | .venv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
auth_tests             |     raise exc
auth_tests             | .venv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app
auth_tests             |     await app(scope, receive, sender)
auth_tests             | .venv/lib/python3.12/site-packages/fastapi/routing.py:106: in app
auth_tests             |     response = await f(request)
auth_tests             |                ^^^^^^^^^^^^^^^^
auth_tests             | .venv/lib/python3.12/site-packages/fastapi/routing.py:430: in app
auth_tests             |     raw_response = await run_endpoint_function(
auth_tests             | .venv/lib/python3.12/site-packages/fastapi/routing.py:316: in run_endpoint_function
auth_tests             |     return await dependant.call(**values)
auth_tests             |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
auth_tests             | src/modules/auth/auth_router.py:38: in register
auth_tests             |     return await auth_service.register_new_user(user_in)
auth_tests             |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
auth_tests             | src/modules/auth/auth_app.py:28: in register_new_user
auth_tests             |     hashed_password = get_password_hash(user_in.password)
auth_tests             |                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
auth_tests             | src/modules/auth/auth_metier.py:15: in get_password_hash
auth_tests             |     return pwd_context.hash(password)
auth_tests             |            ^^^^^^^^^^^^^^^^^^^^^^^^^^
auth_tests             | .venv/lib/python3.12/site-packages/passlib/context.py:2258: in hash
auth_tests             |     return record.hash(secret, **kwds)
auth_tests             |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
auth_tests             | .venv/lib/python3.12/site-packages/passlib/utils/handlers.py:779: in hash
auth_tests             |     self.checksum = self._calc_checksum(secret)
auth_tests             |                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^
auth_tests             | .venv/lib/python3.12/site-packages/passlib/handlers/bcrypt.py:591: in _calc_checksum
auth_tests             |     self._stub_requires_backend()
auth_tests             | .venv/lib/python3.12/site-packages/passlib/utils/handlers.py:2254: in _stub_requires_backend
auth_tests             |     cls.set_backend()
auth_tests             | .venv/lib/python3.12/site-packages/passlib/utils/handlers.py:2156: in set_backend
auth_tests             |     return owner.set_backend(name, dryrun=dryrun)
auth_tests             |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
auth_tests             | .venv/lib/python3.12/site-packages/passlib/utils/handlers.py:2163: in set_backend
auth_tests             |     return cls.set_backend(name, dryrun=dryrun)
auth_tests             |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
auth_tests             | .venv/lib/python3.12/site-packages/passlib/utils/handlers.py:2188: in set_backend
auth_tests             |     cls._set_backend(name, dryrun)
auth_tests             | .venv/lib/python3.12/site-packages/passlib/utils/handlers.py:2311: in _set_backend
auth_tests             |     super(SubclassBackendMixin, cls)._set_backend(name, dryrun)
auth_tests             | .venv/lib/python3.12/site-packages/passlib/utils/handlers.py:2224: in _set_backend
auth_tests             |     ok = loader(**kwds)
auth_tests             |          ^^^^^^^^^^^^^^
auth_tests             | .venv/lib/python3.12/site-packages/passlib/handlers/bcrypt.py:626: in _load_backend_mixin
auth_tests             |     return mixin_cls._finalize_backend_mixin(name, dryrun)
auth_tests             |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
auth_tests             | .venv/lib/python3.12/site-packages/passlib/handlers/bcrypt.py:421: in _finalize_backend_mixin
auth_tests             |     if detect_wrap_bug(IDENT_2A):
auth_tests             |        ^^^^^^^^^^^^^^^^^^^^^^^^^
auth_tests             | .venv/lib/python3.12/site-packages/passlib/handlers/bcrypt.py:380: in detect_wrap_bug
auth_tests             |     if verify(secret, bug_hash):
auth_tests             |        ^^^^^^^^^^^^^^^^^^^^^^^^
auth_tests             | .venv/lib/python3.12/site-packages/passlib/utils/handlers.py:792: in verify
auth_tests             |     return consteq(self._calc_checksum(secret), chk)
auth_tests             |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^
auth_tests             | _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
auth_tests             | 
auth_tests             | self = <passlib.handlers.bcrypt._BcryptBackend object at 0x7e6c5c343f20>
auth_tests             | secret = b'01234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345...7890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234'
auth_tests             | 
auth_tests             |     def _calc_checksum(self, secret):
auth_tests             |         # bcrypt behavior:
auth_tests             |         #   secret must be bytes
auth_tests             |         #   config must be ascii bytes
auth_tests             |         #   returns ascii bytes
auth_tests             |         secret, ident = self._prepare_digest_args(secret)
auth_tests             |         config = self._get_config(ident)
auth_tests             |         if isinstance(config, unicode):
auth_tests             |             config = config.encode("ascii")
auth_tests             | >       hash = _bcrypt.hashpw(secret, config)
auth_tests             |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
auth_tests             | E       ValueError: password cannot be longer than 72 bytes, truncate manually if necessary (e.g. my_password[:72])
auth_tests             | 
auth_tests             | .venv/lib/python3.12/site-packages/passlib/handlers/bcrypt.py:655: ValueError
auth_tests             | ------------------------------ Captured log call -------------------------------
auth_tests             | WARNING  passlib.handlers.bcrypt:bcrypt.py:622 (trapped) error reading bcrypt version
auth_tests             | Traceback (most recent call last):
auth_tests             |   File "/app/.venv/lib/python3.12/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
auth_tests             |     version = _bcrypt.__about__.__version__
auth_tests             |               ^^^^^^^^^^^^^^^^^
auth_tests             | AttributeError: module 'bcrypt' has no attribute '__about__'
auth_tests             | =============================== warnings summary ===============================
auth_tests             | .venv/lib/python3.12/site-packages/passlib/utils/__init__.py:854
auth_tests             |   /app/.venv/lib/python3.12/site-packages/passlib/utils/__init__.py:854: DeprecationWarning: 'crypt' is deprecated and slated for removal in Python 3.13
auth_tests             |     from crypt import crypt as _crypt
auth_tests             | 
auth_tests             | -- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
auth_tests             | =========================== short test summary info ============================
auth_tests             | FAILED tests/test_auth.py::test_register_user - ValueError: password cannot b...
auth_tests             | FAILED tests/test_auth.py::test_login_user - ValueError: password cannot be l...
auth_tests             | ==================== 2 failed, 1 passed, 1 warning in 8.05s ====================
auth_db                | The files belonging to this database system will be owned by user "postgres".
auth_db                | This user must also own the server process.
auth_db                | 
auth_db                | The database cluster will be initialized with locale "en_US.utf8".
auth_db                | The default database encoding has accordingly been set to "UTF8".
auth_db                | The default text search configuration will be set to "english".
auth_db                | 
auth_db                | Data page checksums are disabled.
auth_db                | 
auth_db                | fixing permissions on existing directory /var/lib/postgresql/data ... ok
auth_db                | creating subdirectories ... ok
auth_db                | selecting dynamic shared memory implementation ... posix
auth_db                | selecting default max_connections ... 100
auth_db                | selecting default shared_buffers ... 128MB
auth_db                | selecting default time zone ... UTC
auth_db                | creating configuration files ... ok
auth_db                | running bootstrap script ... ok
auth_db                | sh: locale: not found
auth_db                | 2025-12-11 20:02:06.255 UTC [41] WARNING:  no usable system locales were found
auth_db                | performing post-bootstrap initialization ... ok
auth_db                | initdb: warning: enabling "trust" authentication for local connections
auth_db                | initdb: hint: You can change this by editing pg_hba.conf or using the option -A, or --auth-local and --auth-host, the next time you run initdb.
auth_db                | syncing data to disk ... ok
auth_db                | 
auth_db                | 
auth_db                | Success. You can now start the database server using:
auth_db                | 
auth_db                |     pg_ctl -D /var/lib/postgresql/data -l logfile start
auth_db                | 
auth_db                | waiting for server to start....2025-12-11 20:02:09.739 UTC [53] LOG:  starting PostgreSQL 16.11 on x86_64-pc-linux-musl, compiled by gcc (Alpine 15.2.0) 15.2.0, 64-bit
auth_db                | 2025-12-11 20:02:09.755 UTC [53] LOG:  listening on Unix socket "/var/run/postgresql/.s.PGSQL.5432"
auth_db                | 2025-12-11 20:02:09.772 UTC [56] LOG:  database system was shut down at 2025-12-11 20:02:08 UTC
auth_db                | 2025-12-11 20:02:09.788 UTC [53] LOG:  database system is ready to accept connections
auth_db                |  done
auth_db                | server started
auth_db                | CREATE DATABASE
auth_db                | 
auth_db                | 
auth_db                | /usr/local/bin/docker-entrypoint.sh: ignoring /docker-entrypoint-initdb.d/*
auth_db                | 
auth_db                | waiting for server to shut down....2025-12-11 20:02:10.374 UTC [53] LOG:  received fast shutdown request
auth_db                | 2025-12-11 20:02:10.379 UTC [53] LOG:  aborting any active transactions
auth_db                | 2025-12-11 20:02:10.391 UTC [53] LOG:  background worker "logical replication launcher" (PID 59) exited with exit code 1
auth_db                | 2025-12-11 20:02:10.392 UTC [54] LOG:  shutting down
auth_db                | 2025-12-11 20:02:10.396 UTC [54] LOG:  checkpoint starting: shutdown immediate
auth_db                | 2025-12-11 20:02:10.701 UTC [54] LOG:  checkpoint complete: wrote 926 buffers (5.7%); 0 WAL file(s) added, 0 removed, 0 recycled; write=0.112 s, sync=0.174 s, total=0.310 s; sync files=301, longest=0.119 s, average=0.001 s; distance=4272 kB, estimate=4272 kB; lsn=0/191E920, redo lsn=0/191E920
auth_db                | 2025-12-11 20:02:10.723 UTC [53] LOG:  database system is shut down
auth_db                |  done
auth_db                | server stopped
auth_db                | 
auth_db                | PostgreSQL init process complete; ready for start up.
auth_db                | 
auth_db                | 2025-12-11 20:02:10.854 UTC [1] LOG:  starting PostgreSQL 16.11 on x86_64-pc-linux-musl, compiled by gcc (Alpine 15.2.0) 15.2.0, 64-bit
auth_db                | 2025-12-11 20:02:10.854 UTC [1] LOG:  listening on IPv4 address "0.0.0.0", port 5432
auth_db                | 2025-12-11 20:02:10.854 UTC [1] LOG:  listening on IPv6 address "::", port 5432
auth_db                | 2025-12-11 20:02:10.862 UTC [1] LOG:  listening on Unix socket "/var/run/postgresql/.s.PGSQL.5432"
auth_db                | 2025-12-11 20:02:10.877 UTC [69] LOG:  database system was shut down at 2025-12-11 20:02:10 UTC
auth_db                | 2025-12-11 20:02:10.898 UTC [1] LOG:  database system is ready to accept connections
auth_db                | 2025-12-11 20:07:10.881 UTC [67] LOG:  checkpoint starting: time
auth_db                | 2025-12-11 20:07:14.432 UTC [67] LOG:  checkpoint complete: wrote 38 buffers (0.2%); 0 WAL file(s) added, 0 removed, 0 recycled; write=3.520 s, sync=0.011 s, total=3.551 s; sync files=11, longest=0.006 s, average=0.001 s; distance=191 kB, estimate=191 kB; lsn=0/194E868, redo lsn=0/194E830
auth_db                | 2025-12-11 20:32:10.850 UTC [67] LOG:  checkpoint starting: time
auth_db                | 2025-12-11 20:32:14.650 UTC [67] LOG:  checkpoint complete: wrote 38 buffers (0.2%); 0 WAL file(s) added, 0 removed, 0 recycled; write=3.721 s, sync=0.015 s, total=3.801 s; sync files=32, longest=0.007 s, average=0.001 s; distance=142 kB, estimate=186 kB; lsn=0/19720B8, redo lsn=0/1972080
auth_db                | 2025-12-11 20:44:57.080 UTC [3674] ERROR:  relation "users" does not exist at character 76
auth_db                | 2025-12-11 20:44:57.080 UTC [3674] STATEMENT:  SELECT users.id, users.email, users.hashed_password, users.is_active 
auth_db                | 	FROM users 
auth_db                | 	WHERE users.email = $1::VARCHAR
auth_db                | 2025-12-11 20:45:00.204 UTC [3674] LOG:  could not receive data from client: Connection reset by peer
auth_db                | 2025-12-11 20:45:00.214 UTC [3674] LOG:  unexpected EOF on client connection with an open transaction
auth_db                | 2025-12-11 20:46:25.585 UTC [3801] ERROR:  relation "users" does not exist at character 76
auth_db                | 2025-12-11 20:46:25.585 UTC [3801] STATEMENT:  SELECT users.id, users.email, users.hashed_password, users.is_active 
auth_db                | 	FROM users 
auth_db                | 	WHERE users.email = $1::VARCHAR
auth_db                | 2025-12-11 20:46:31.988 UTC [3801] LOG:  could not receive data from client: Connection reset by peer
auth_db                | 2025-12-11 20:46:31.988 UTC [3801] LOG:  unexpected EOF on client connection with an open transaction
auth_db                | 2025-12-11 20:48:56.865 UTC [4013] ERROR:  relation "users" does not exist at character 76
auth_db                | 2025-12-11 20:48:56.865 UTC [4013] STATEMENT:  SELECT users.id, users.email, users.hashed_password, users.is_active 
auth_db                | 	FROM users 
auth_db                | 	WHERE users.email = $1::VARCHAR
auth_db                | 2025-12-11 20:48:59.704 UTC [4013] LOG:  could not receive data from client: Connection reset by peer
auth_db                | 2025-12-11 20:48:59.704 UTC [4013] LOG:  unexpected EOF on client connection with an open transaction
auth_db                | 2025-12-11 20:52:34.427 UTC [4331] LOG:  could not receive data from client: Connection reset by peer
auth_db                | 2025-12-11 20:52:34.427 UTC [4333] LOG:  could not receive data from client: Connection reset by peer
auth_db                | 
auth_db                | PostgreSQL Database directory appears to contain a database; Skipping initialization
auth_db                | 
auth_db                | 2025-12-11 21:18:41.929 UTC [1] LOG:  starting PostgreSQL 16.11 on x86_64-pc-linux-musl, compiled by gcc (Alpine 15.2.0) 15.2.0, 64-bit
auth_db                | 2025-12-11 21:18:41.930 UTC [1] LOG:  listening on IPv4 address "0.0.0.0", port 5432
auth_db                | 2025-12-11 21:18:41.930 UTC [1] LOG:  listening on IPv6 address "::", port 5432
auth_db                | 2025-12-11 21:18:42.030 UTC [1] LOG:  listening on Unix socket "/var/run/postgresql/.s.PGSQL.5432"
auth_db                | 2025-12-11 21:18:42.114 UTC [29] LOG:  database system was shut down at 2025-12-11 20:56:10 UTC
auth_db                | 2025-12-11 21:18:42.240 UTC [1] LOG:  database system is ready to accept connections
auth_db                | 2025-12-11 21:19:26.731 UTC [88] LOG:  could not receive data from client: Connection reset by peer
auth_db                | 2025-12-11 21:19:26.731 UTC [98] LOG:  could not receive data from client: Connection reset by peer
auth_db                | 2025-12-11 21:23:42.209 UTC [27] LOG:  checkpoint starting: time
auth_db                | 2025-12-11 21:23:46.511 UTC [27] LOG:  checkpoint complete: wrote 44 buffers (0.3%); 0 WAL file(s) added, 0 removed, 0 recycled; write=4.144 s, sync=0.092 s, total=4.303 s; sync files=38, longest=0.039 s, average=0.003 s; distance=198 kB, estimate=198 kB; lsn=0/19DD3E0, redo lsn=0/19DD3A8
auth_db                | 2025-12-11 22:28:25.359 UTC [5924] LOG:  could not receive data from client: Connection reset by peer
auth_db                | 2025-12-11 22:28:25.359 UTC [5926] LOG:  could not receive data from client: Connection reset by peer
auth_db                | 2025-12-11 22:28:43.650 UTC [27] LOG:  checkpoint starting: time
auth_db                | 2025-12-11 22:28:48.239 UTC [27] LOG:  checkpoint complete: wrote 45 buffers (0.3%); 0 WAL file(s) added, 0 removed, 0 recycled; write=4.446 s, sync=0.030 s, total=4.590 s; sync files=39, longest=0.010 s, average=0.001 s; distance=209 kB, estimate=209 kB; lsn=0/1A11888, redo lsn=0/1A11850
auth_db                | 2025-12-11 22:34:14.418 UTC [6413] LOG:  could not receive data from client: Connection reset by peer
auth_db                | 2025-12-11 22:34:14.418 UTC [6422] LOG:  could not receive data from client: Connection reset by peer
auth_db                | 2025-12-11 22:38:43.417 UTC [27] LOG:  checkpoint starting: time
auth_db                | 2025-12-11 22:38:49.745 UTC [27] LOG:  checkpoint complete: wrote 63 buffers (0.4%); 0 WAL file(s) added, 0 removed, 0 recycled; write=6.228 s, sync=0.081 s, total=6.329 s; sync files=57, longest=0.069 s, average=0.002 s; distance=383 kB, estimate=383 kB; lsn=0/1A71780, redo lsn=0/1A71748
auth_db                | 2025-12-11 22:43:43.845 UTC [27] LOG:  checkpoint starting: time
auth_db                | 2025-12-11 22:43:49.593 UTC [27] LOG:  checkpoint complete: wrote 57 buffers (0.3%); 0 WAL file(s) added, 0 removed, 0 recycled; write=5.680 s, sync=0.034 s, total=5.749 s; sync files=54, longest=0.017 s, average=0.001 s; distance=333 kB, estimate=378 kB; lsn=0/1AC4F68, redo lsn=0/1AC4F30
auth_db                | 2025-12-11 22:44:35.161 UTC [7320] ERROR:  relation "users" does not exist at character 76
auth_db                | 2025-12-11 22:44:35.161 UTC [7320] STATEMENT:  SELECT users.id, users.email, users.hashed_password, users.is_active 
auth_db                | 	FROM users 
auth_db                | 	WHERE users.email = $1::VARCHAR
auth_db                | 2025-12-11 22:44:36.571 UTC [7320] ERROR:  relation "users" does not exist at character 76
auth_db                | 2025-12-11 22:44:36.571 UTC [7320] STATEMENT:  SELECT users.id, users.email, users.hashed_password, users.is_active 
auth_db                | 	FROM users 
auth_db                | 	WHERE users.email = $1::VARCHAR
auth_db                | 2025-12-11 22:45:39.626 UTC [7320] ERROR:  relation "users" does not exist at character 76
auth_db                | 2025-12-11 22:45:39.626 UTC [7320] STATEMENT:  SELECT users.id, users.email, users.hashed_password, users.is_active 
auth_db                | 	FROM users 
auth_db                | 	WHERE users.email = $1::VARCHAR
auth_db                | 
auth_db                | PostgreSQL Database directory appears to contain a database; Skipping initialization
auth_db                | 
auth_db                | 2025-12-11 22:58:31.449 UTC [1] LOG:  starting PostgreSQL 16.11 on x86_64-pc-linux-musl, compiled by gcc (Alpine 15.2.0) 15.2.0, 64-bit
auth_db                | 2025-12-11 22:58:31.450 UTC [1] LOG:  listening on IPv4 address "0.0.0.0", port 5432
auth_db                | 2025-12-11 22:58:31.450 UTC [1] LOG:  listening on IPv6 address "::", port 5432
auth_db                | 2025-12-11 22:58:31.460 UTC [1] LOG:  listening on Unix socket "/var/run/postgresql/.s.PGSQL.5432"
auth_db                | 2025-12-11 22:58:31.473 UTC [29] LOG:  database system was shut down at 2025-12-11 22:50:32 UTC
auth_db                | 2025-12-11 22:58:31.529 UTC [1] LOG:  database system is ready to accept connections
auth_db                | 2025-12-11 23:00:04.279 UTC [174] ERROR:  relation "users" does not exist at character 76
auth_db                | 2025-12-11 23:00:04.279 UTC [174] STATEMENT:  SELECT users.id, users.email, users.hashed_password, users.is_active 
auth_db                | 	FROM users 
auth_db                | 	WHERE users.email = $1::VARCHAR
auth_db                | 2025-12-11 23:00:36.591 UTC [174] ERROR:  relation "users" does not exist at character 76
auth_db                | 2025-12-11 23:00:36.591 UTC [174] STATEMENT:  SELECT users.id, users.email, users.hashed_password, users.is_active 
auth_db                | 	FROM users 
auth_db                | 	WHERE users.email = $1::VARCHAR
auth_db                | 2025-12-11 23:00:45.621 UTC [174] ERROR:  relation "users" does not exist at character 76
auth_db                | 2025-12-11 23:00:45.621 UTC [174] STATEMENT:  SELECT users.id, users.email, users.hashed_password, users.is_active 
auth_db                | 	FROM users 
auth_db                | 	WHERE users.email = $1::VARCHAR
auth_db                | 2025-12-11 23:00:54.647 UTC [174] ERROR:  relation "users" does not exist at character 76
auth_db                | 2025-12-11 23:00:54.647 UTC [174] STATEMENT:  SELECT users.id, users.email, users.hashed_password, users.is_active 
auth_db                | 	FROM users 
auth_db                | 	WHERE users.email = $1::VARCHAR
auth_db                | 2025-12-11 23:03:31.572 UTC [27] LOG:  checkpoint starting: time
auth_db                | 2025-12-11 23:03:36.767 UTC [27] LOG:  checkpoint complete: wrote 53 buffers (0.3%); 0 WAL file(s) added, 0 removed, 0 recycled; write=5.080 s, sync=0.024 s, total=5.196 s; sync files=55, longest=0.006 s, average=0.001 s; distance=325 kB, estimate=325 kB; lsn=0/1B16670, redo lsn=0/1B16638
auth_db                | 2025-12-11 23:05:13.346 UTC [174] ERROR:  relation "users" does not exist at character 76
auth_db                | 2025-12-11 23:05:13.346 UTC [174] STATEMENT:  SELECT users.id, users.email, users.hashed_password, users.is_active 
auth_db                | 	FROM users 
auth_db                | 	WHERE users.email = $1::VARCHAR
auth_db                | 2025-12-11 23:07:56.813 UTC [174] ERROR:  relation "users" does not exist at character 76
auth_db                | 2025-12-11 23:07:56.813 UTC [174] STATEMENT:  SELECT users.id, users.email, users.hashed_password, users.is_active 
auth_db                | 	FROM users 
auth_db                | 	WHERE users.email = $1::VARCHAR
auth_db                | 2025-12-11 23:08:31.867 UTC [27] LOG:  checkpoint starting: time
auth_db                | 2025-12-11 23:08:32.014 UTC [27] LOG:  checkpoint complete: wrote 1 buffers (0.0%); 0 WAL file(s) added, 0 removed, 0 recycled; write=0.101 s, sync=0.005 s, total=0.148 s; sync files=1, longest=0.005 s, average=0.005 s; distance=6 kB, estimate=293 kB; lsn=0/1B17F18, redo lsn=0/1B17EE0
auth_db                | 2025-12-11 23:11:46.463 UTC [174] ERROR:  relation "users" does not exist at character 76
auth_db                | 2025-12-11 23:11:46.463 UTC [174] STATEMENT:  SELECT users.id, users.email, users.hashed_password, users.is_active 
auth_db                | 	FROM users 
auth_db                | 	WHERE users.email = $1::VARCHAR
auth_db                | 2025-12-11 23:15:24.012 UTC [174] ERROR:  relation "users" does not exist at character 76
auth_db                | 2025-12-11 23:15:24.012 UTC [174] STATEMENT:  SELECT users.id, users.email, users.hashed_password, users.is_active 
auth_db                | 	FROM users 
auth_db                | 	WHERE users.email = $1::VARCHAR
auth_db                | 2025-12-11 23:18:31.209 UTC [27] LOG:  checkpoint starting: time
auth_db                | 2025-12-11 23:18:31.436 UTC [27] LOG:  checkpoint complete: wrote 3 buffers (0.0%); 0 WAL file(s) added, 0 removed, 0 recycled; write=0.205 s, sync=0.006 s, total=0.228 s; sync files=3, longest=0.005 s, average=0.002 s; distance=0 kB, estimate=264 kB; lsn=0/1B182A0, redo lsn=0/1B18268
auth_db                | 2025-12-11 23:29:06.587 UTC [174] ERROR:  relation "users" does not exist at character 76
auth_db                | 2025-12-11 23:29:06.587 UTC [174] STATEMENT:  SELECT users.id, users.email, users.hashed_password, users.is_active 
auth_db                | 	FROM users 
auth_db                | 	WHERE users.email = $1::VARCHAR
auth_db                | 2025-12-11 23:33:31.722 UTC [27] LOG:  checkpoint starting: time
auth_db                | 2025-12-11 23:33:31.973 UTC [27] LOG:  checkpoint complete: wrote 3 buffers (0.0%); 0 WAL file(s) added, 0 removed, 0 recycled; write=0.205 s, sync=0.007 s, total=0.252 s; sync files=3, longest=0.005 s, average=0.003 s; distance=1 kB, estimate=238 kB; lsn=0/1B18750, redo lsn=0/1B18718
auth_db                | 2025-12-11 23:38:32.073 UTC [27] LOG:  checkpoint starting: time
auth_db                | 2025-12-11 23:38:38.832 UTC [27] LOG:  checkpoint complete: wrote 68 buffers (0.4%); 0 WAL file(s) added, 0 removed, 0 recycled; write=6.725 s, sync=0.018 s, total=6.759 s; sync files=57, longest=0.004 s, average=0.001 s; distance=375 kB, estimate=375 kB; lsn=0/1B76638, redo lsn=0/1B76600
auth_db                | 2025-12-11 23:41:31.399 UTC [174] ERROR:  relation "users" does not exist at character 76
auth_db                | 2025-12-11 23:41:31.399 UTC [174] STATEMENT:  SELECT users.id, users.email, users.hashed_password, users.is_active 
auth_db                | 	FROM users 
auth_db                | 	WHERE users.email = $1::VARCHAR
auth_db                | 2025-12-11 23:53:33.128 UTC [27] LOG:  checkpoint starting: time
auth_db                | 2025-12-11 23:53:33.455 UTC [27] LOG:  checkpoint complete: wrote 4 buffers (0.0%); 0 WAL file(s) added, 0 removed, 0 recycled; write=0.304 s, sync=0.008 s, total=0.328 s; sync files=4, longest=0.006 s, average=0.002 s; distance=1 kB, estimate=338 kB; lsn=0/1B76C98, redo lsn=0/1B76C60
auth_db                | 2025-12-11 23:58:33.555 UTC [27] LOG:  checkpoint starting: time
auth_db                | 2025-12-11 23:58:33.793 UTC [27] LOG:  checkpoint complete: wrote 3 buffers (0.0%); 0 WAL file(s) added, 0 removed, 0 recycled; write=0.204 s, sync=0.011 s, total=0.238 s; sync files=3, longest=0.009 s, average=0.004 s; distance=1 kB, estimate=304 kB; lsn=0/1B77290, redo lsn=0/1B77258
auth_db                | 2025-12-12 00:10:44.872 UTC [174] ERROR:  relation "users" does not exist at character 76
auth_db                | 2025-12-12 00:10:44.872 UTC [174] STATEMENT:  SELECT users.id, users.email, users.hashed_password, users.is_active 
auth_db                | 	FROM users 
auth_db                | 	WHERE users.email = $1::VARCHAR
auth_db                | 2025-12-12 00:13:34.098 UTC [27] LOG:  checkpoint starting: time
auth_db                | 2025-12-12 00:13:37.849 UTC [27] LOG:  checkpoint complete: wrote 38 buffers (0.2%); 0 WAL file(s) added, 0 removed, 0 recycled; write=3.720 s, sync=0.017 s, total=3.752 s; sync files=38, longest=0.005 s, average=0.001 s; distance=180 kB, estimate=292 kB; lsn=0/1BA44A8, redo lsn=0/1BA4470
auth_db                | 
auth_db                | PostgreSQL Database directory appears to contain a database; Skipping initialization
auth_db                | 
auth_db                | 2025-12-12 00:23:06.736 UTC [1] LOG:  starting PostgreSQL 16.11 on x86_64-pc-linux-musl, compiled by gcc (Alpine 15.2.0) 15.2.0, 64-bit
auth_db                | 2025-12-12 00:23:06.736 UTC [1] LOG:  listening on IPv4 address "0.0.0.0", port 5432
auth_db                | 2025-12-12 00:23:06.736 UTC [1] LOG:  listening on IPv6 address "::", port 5432
auth_db                | 2025-12-12 00:23:06.857 UTC [1] LOG:  listening on Unix socket "/var/run/postgresql/.s.PGSQL.5432"
auth_db                | 2025-12-12 00:23:07.082 UTC [34] LOG:  database system was shut down at 2025-12-12 00:15:43 UTC
auth_db                | 2025-12-12 00:23:07.453 UTC [1] LOG:  database system is ready to accept connections
